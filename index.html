<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divisor de Texto e Cortador de Imagens</title>
    <link rel="stylesheet" href="style.css"> <!-- Certifique-se que o style.css está correto -->
    <script src="https://apis.google.com/js/api.js"></script> <!-- API do Google -->
</head>
<body>
    <h1>Bem-vindo ao meu site</h1>
    <p>Aqui você pode usar o divisor de texto e o cortador de imagens.</p>

    <!-- Botões para escolher a funcionalidade -->
    <button id="btnDivisor">Divisor e Tradutor de Texto</button>
    <button id="btnCorte">Corte de Imagens Local</button>
    <button id="btnDrive">Corte de Imagens do Google Drive</button>

    <!-- Seção de Divisão e Tradução de Texto -->
    <section id="divisor-texto" style="display: none;">
        <h2>Divisor e Tradutor de Texto</h2>
        <textarea id="texto" rows="5" cols="30" placeholder="Insira seu texto aqui"></textarea><br>
        <input type="number" id="tamanho_corte" placeholder="Tamanho do corte" /><br>
        <label for="idioma_origem">Escolha o idioma de origem:</label>
        <select id="idioma_origem">
            <option value="auto">Detectar automaticamente</option>
            <option value="en">Inglês</option>
            <option value="es">Espanhol</option>
            <option value="fr">Francês</option>
            <option value="de">Alemão</option>
            <option value="pt">Português</option>
            <option value="it">Italiano</option>
        </select><br>
        <label for="idioma_destino">Escolha o idioma de destino:</label>
        <select id="idioma_destino">
            <option value="es">Espanhol</option>
            <option value="fr">Francês</option>
            <option value="de">Alemão</option>
            <option value="pt">Português</option>
            <option value="it">Italiano</option>
            <option value="en">Inglês</option>
        </select><br>
        <label>
            <input type="checkbox" id="traduzir_check"> Traduzir o texto
        </label><br>
        <button id="dividir">Dividir e Traduzir Texto</button>
        <div id="resultado"></div>
    </section>

    <!-- Seção de Corte de Imagens Local -->
    <section id="corte-imagens" style="display: none;">
        <h2>Corte de Imagens</h2>
        <input type="file" id="imagem_input" accept="image/*"><br>
        <button id="cortar_imagem">Cortar Imagem</button>
        <div id="imagem_cortada"></div>
    </section>

    <!-- Seção de Corte de Imagens do Google Drive -->
    <section id="drive-corte" style="display: none;">
        <h2>Corte de Imagens do Google Drive</h2>
        <button id="authorize_button" style="display: none;">Autorizar Google Drive</button>
        <button id="signout_button" style="display: none;">Sair</button>
        <div id="content"></div> <!-- Exibir subpastas e arquivos -->
        <div id="imagem_drive_cortada"></div> <!-- Resultado do corte -->
    </section>

    <!-- Scripts de funcionalidade -->
    <script src="popup.js"></script> <!-- Script de dividir texto e traduzir -->
    <script src="imagem_corte.js"></script> <!-- Script de cortar imagens localmente -->
    <script>
        // Lógica para alternar entre as seções
        document.getElementById('btnDivisor').addEventListener('click', function () {
            document.getElementById('divisor-texto').style.display = 'block';
            document.getElementById('corte-imagens').style.display = 'none';
            document.getElementById('drive-corte').style.display = 'none';
        });

        document.getElementById('btnCorte').addEventListener('click', function () {
            document.getElementById('divisor-texto').style.display = 'none';
            document.getElementById('corte-imagens').style.display = 'block';
            document.getElementById('drive-corte').style.display = 'none';
        });

        document.getElementById('btnDrive').addEventListener('click', function () {
            document.getElementById('divisor-texto').style.display = 'none';
            document.getElementById('corte-imagens').style.display = 'none';
            document.getElementById('drive-corte').style.display = 'block';
        });

        // Parte de autenticação e corte de imagens do Google Drive (do código anterior)
        var CLIENT_ID = '533757513621-n6vdm3e4j6h9r205notvuu1qc68gt85n.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyBHnu3JR3yxeqdk-vMKWo_RhansfxpvF9Q';
        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        var SCOPES = 'https://www.googleapis.com/auth/drive';

        var authorizeButton = document.getElementById('authorize_button');
        var signoutButton = document.getElementById('signout_button');
        var content = document.getElementById('content');
        var F1_FOLDER_ID = '1yYedANca20yH4sfUy3o_52Jh-gejIhXK'; // ID da pasta F1
        var FD_FOLDER_ID = '1TqOFWuxZwtdUt1yrvdrRoumwwllgVosX'; // ID da pasta FD

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(function () {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                authorizeButton.onclick = handleAuthClick;
                signoutButton.onclick = handleSignoutClick;
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                authorizeButton.style.display = 'none';
                signoutButton.style.display = 'block';
                listFolders(F1_FOLDER_ID);
            } else {
                authorizeButton.style.display = 'block';
                signoutButton.style.display = 'none';
            }
        }

        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick() {
            gapi.auth2.getAuthInstance().signOut();
        }

        function listFolders(folderId) {
            gapi.client.drive.files.list({
                'q': `'${folderId}' in parents and mimeType = 'application/vnd.google-apps.folder'`,
                'fields': 'nextPageToken, files(id, name)'
            }).then(function (response) {
                var folders = response.result.files;
                var output = '<h3>Subpastas encontradas em F1:</h3><ul>';
                if (folders.length > 0) {
                    folders.forEach(function (folder) {
                        output += `<li>${folder.name} <button onclick="listFiles('${folder.id}')">Ver Arquivos</button></li>`;
                    });
                    output += '</ul>';
                    content.innerHTML = output;
                } else {
                    content.innerHTML = 'Nenhuma subpasta encontrada.';
                }
            });
        }

        function listFiles(folderId) {
            gapi.client.drive.files.list({
                'q': `'${folderId}' in parents and mimeType contains 'image/'`,
                'fields': 'nextPageToken, files(id, name, mimeType)'
            }).then(function (response) {
                var files = response.result.files;
                var output = '<h3>Arquivos de Imagem:</h3><ul>';
                if (files.length > 0) {
                    files.forEach(function (file) {
                        output += `<li>${file.name} <button onclick="downloadAndCutFile('${file.id}')">Cortar</button></li>`;
                    });
                    output += '</ul>';
                    content.innerHTML = output;
                } else {
                    content.innerHTML = 'Nenhum arquivo de imagem encontrado.';
                }
            });
        }

        function downloadAndCutFile(fileId) {
            gapi.client.drive.files.get({
                fileId: fileId,
                alt: 'media'
            }).then(function (response) {
                var blob = new Blob([response.body], { type: 'image/jpeg' });
                var url = URL.createObjectURL(blob);
                var img = new Image();
                img.src = url;
                img.onload = function () {
                    cortarImagem(img, fileId);
                };
            });
        }

        function cortarImagem(img, fileId) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const corteLargura = 200;
            const corteAltura = 200;

            canvas.width = corteLargura;
            canvas.height = corteAltura;
            ctx.drawImage(img, 0, 0, corteLargura, corteAltura, 0, 0, corteLargura, corteAltura);

            canvas.toBlob(function (blob) {
                uploadFile(blob, fileId);
            }, 'image/jpeg');
        }

        function uploadFile(blob, originalFileId) {
            const fileName = 'imagem_cortada_' + originalFileId + '.jpg';

            var metadata = {
                'name': fileName,
                'parents': [FD_FOLDER_ID],
                'mimeType': 'image/jpeg'
            };

            var form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', blob);

            fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
                method: 'POST',
                headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth.getToken().access_token }),
                body: form
            }).then((res) => res.json())
            .then(function (val) {
                document.getElementById('imagem_drive_cortada').innerHTML = 'Upload concluído: ' + fileName;
            });
        }

        handleClientLoad();
    </script>
</body>
</html>
